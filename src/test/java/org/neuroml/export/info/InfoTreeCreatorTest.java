package org.neuroml.export.info;

import java.io.IOException;

import javax.xml.bind.JAXBException;

import junit.framework.Assert;
import junit.framework.TestCase;

import org.lemsml.export.base.GenerationException;
import org.lemsml.jlems.core.expression.ParseError;
import org.lemsml.jlems.core.run.ConnectionError;
import org.lemsml.jlems.core.run.RuntimeError;
import org.lemsml.jlems.core.sim.ContentError;
import org.lemsml.jlems.core.sim.ParseException;
import org.lemsml.jlems.core.type.BuildException;
import org.lemsml.jlems.core.xml.XMLException;
import org.lemsml.jlems.io.util.JUtil;
import org.neuroml.export.Main;
import org.neuroml.export.info.model.InfoNode;
import org.neuroml.model.NeuroMLDocument;
import org.neuroml.model.util.NeuroMLConverter;

/**
 * @author matteocantarelli
 *
 */
public class InfoTreeCreatorTest extends TestCase
{

	public void testAbstract() throws ContentError, ParseError, ParseException, BuildException, XMLException, IOException, ConnectionError, RuntimeError, JAXBException, GenerationException
	{
		String expected="Element iafRef:\n" + 
				"	ID: iafRef\n" + 
				"Element adExBurst:\n" + 
				"	ID: adExBurst";
		Assert.assertEquals(expected, getInfoTreeAsString("NML2_AbstractCells.nml"));
	}

	public void testCell() throws ContentError, ParseError, ParseException, BuildException, XMLException, IOException, ConnectionError, RuntimeError, JAXBException, GenerationException
	{
		String expected="Cell SpikingCell:\n" + 
				"	ID: SpikingCell\n" + 
				"	Description: A Simple Spiking cell for testing purposes\n" + 
				"	Number of segments: 4";
		Assert.assertEquals(expected, getInfoTreeAsString("NML2_FullCell.nml"));
	}

	public void testIonChannel() throws ContentError, ParseError, ParseException, BuildException, XMLException, IOException, ConnectionError, RuntimeError, JAXBException, GenerationException
	{
		String expected="Ion Channel na:\n" + 
				"	ID: na\n" + 
				"	Gates:\n" + 
				"		gate m:\n" + 
				"			instances: 3\n" + 
				"			forward rate: 1000.00 * (v - -0.0400000)/0.0100000 / ( 1 - exp(-(v - -0.0400000) / 0.0100000))\n" + 
				"			reverse rate: 4000.00 * exp((v - -0.0650000)/-0.0180000)\n" + 
				"			forward rate plot: PlotNode [Title=RatePlot, X=mV, Y=ms-1, Data=[Data [X=[-8.00000011920929, -7.900000117719173, -7.800000116229057, -7.700000114738941, -7.600000113248825, -7.500000111758709, -7.400000110268593, -7.300000108778477, -7.200000107288361, -7.1000001057982445, -7.000000104308128, -6.900000102818012, -6.800000101327896, -6.70000009983778, -6.600000098347664, -6.500000096857548, -6.400000095367432, -6.3000000938773155, -6.200000092387199, -6.100000090897083, -6.000000089406967, -5.900000087916851, -5.800000086426735, -5.700000084936619, -5.600000083446503, -5.500000081956387, -5.4000000804662704, -5.300000078976154, -5.200000077486038, -5.100000075995922, -5.000000074505806, -4.90000007301569, -4.800000071525574, -4.700000070035458, -4.6000000685453415, -4.500000067055225, -4.400000065565109, -4.300000064074993, -4.200000062584877, -4.100000061094761, -4.000000059604645, -3.9000000581145287, -3.8000000566244125, -3.7000000551342964, -3.6000000536441803, -3.500000052154064, -3.400000050663948, -3.300000049173832, -3.200000047683716, -3.1000000461935997, -3.0000000447034836, -2.9000000432133675, -2.8000000417232513, -2.7000000402331352, -2.600000038743019, -2.500000037252903, -2.400000035762787, -2.3000000342726707, -2.2000000327825546, -2.1000000312924385, -2.0000000298023224, -1.9000000283122063, -1.8000000268220901, -1.700000025331974, -1.600000023841858, -1.5000000223517418, -1.4000000208616257, -1.3000000193715096, -1.2000000178813934, -1.1000000163912773, -1.0000000149011612, -0.9000000134110451, -0.800000011920929, -0.7000000104308128, -0.6000000089406967, -0.5000000074505806, -0.4000000059604645, -0.30000000447034836, -0.20000000298023224, -0.10000000149011612, 0.0, 0.10000000149011612, 0.20000000298023224, 0.30000000447034836, 0.4000000059604645, 0.5000000074505806, 0.6000000089406967, 0.7000000104308128, 0.800000011920929, 0.9000000134110451, 1.0000000149011612, 1.1000000163912773, 1.2000000178813934, 1.3000000193715096, 1.4000000208616257, 1.5000000223517418, 1.600000023841858, 1.700000025331974, 1.8000000268220901, 1.9000000283122063, 2.0000000298023224, 2.1000000312924385, 2.2000000327825546, 2.3000000342726707, 2.400000035762787, 2.500000037252903, 2.600000038743019, 2.7000000402331352, 2.8000000417232513, 2.9000000432133675, 3.0000000447034836, 3.1000000461935997, 3.200000047683716, 3.300000049173832, 3.400000050663948, 3.500000052154064, 3.6000000536441803, 3.7000000551342964, 3.8000000566244125, 3.9000000581145287, 4.000000059604645, 4.100000061094761, 4.200000062584877, 4.300000064074993, 4.400000065565109, 4.500000067055225, 4.6000000685453415, 4.700000070035458, 4.800000071525574, 4.90000007301569, 5.000000074505806, 5.100000075995922, 5.200000077486038, 5.300000078976154, 5.4000000804662704, 5.500000081956387, 5.600000083446503, 5.700000084936619, 5.800000086426735, 5.900000087916851, 6.000000089406967, 6.100000090897083, 6.200000092387199, 6.3000000938773155, 6.400000095367432, 6.500000096857548, 6.600000098347664, 6.70000009983778, 6.800000101327896, 6.900000102818012, 7.000000104308128, 7.1000001057982445, 7.200000107288361, 7.300000108778477, 7.400000110268593, 7.500000111758709, 7.600000113248825, 7.700000114738941, 7.800000116229057, 7.900000117719173, 8.00000011920929, 8.100000120699406, 8.200000122189522, 8.300000123679638, 8.400000125169754, 8.50000012665987, 8.600000128149986, 8.700000129640102, 8.800000131130219, 8.900000132620335, 9.00000013411045, 9.100000135600567, 9.200000137090683, 9.300000138580799, 9.400000140070915, 9.500000141561031, 9.600000143051147, 9.700000144541264, 9.80000014603138, 9.900000147521496], Y=[3335.981951005281, 3344.992545082741, 3354.0096248024656, 3363.0331550890664, 3372.0631009807676, 3381.0994276298343, 3390.14210030299, 3399.191084381824, 3408.246345363191, 3417.307848859597, 3426.37556059958, 3435.449446428071, 3444.5294723067636, 3453.6156043144533, 3462.7078086473775, 3471.8060516195487, 3480.9102996630727, 3490.0205193284564, 3499.1366772849105, 3508.258740320642, 3517.3866753431353, 3526.520449379424, 3535.660029576355, 3544.8053832008486, 3553.9564776401357, 3563.113280401999, 3572.2757591150043, 3581.443881528711, 3590.6176155138937, 3599.7969290627325, 3608.981790289015, 3618.1721674283167, 3627.3680288381756, 3636.5693429982675, 3645.776078510555, 3654.9882040994476, 3664.2056886119394, 3673.4285010177464, 3682.6566104094322, 3691.889986002529, 3701.1285971356438, 3710.3724132705684, 3719.621403992368, 3728.875539009474, 3738.1347881537617, 3747.3991213806225, 3756.66850876903, 3765.942920521597, 3775.2223269646265, 3784.506698548154, 3793.796005845981, 3803.0902195557132, 3812.389310498766, 3821.6932496203945, 3831.0020079896917, 3840.315556799594, 3849.633867366874, 3858.956911132124, 3868.2846596597456, 3877.6170846379146, 3886.954157878554, 3896.295851317292, 3905.6421370134217, 3914.9929871498425, 3924.3483740330084, 3933.7082700928618, 3943.072647882763, 3952.4414800794157, 3961.814739482783, 3971.1923990160026, 3980.574431725289, 3989.960810779839, 3999.3515094717222, 4008.7465012157727, 4018.145759549473, 4027.54925813283, 4036.9569707482506, 4046.3688713004085, 4055.7849338161045, 4065.2051324441254, 4074.629441455096, 4084.057835241326, 4093.4902883166474, 4102.92677531626, 4112.367270996555, 4121.811750234945, 4131.260188029688, 4140.712559499704, 4150.168839884386, 4159.629004543411, 4169.093028956542, 4178.560888723428, 4188.032559563402, 4197.508017315269, 4206.987237937089, 4216.470197505965, 4225.95687221782, 4235.44723838717, 4244.941272446891, 4254.438950947995, 4263.940250559379, 4273.445148067593, 4282.953620376591, 4292.465644507483, 4301.981197598282, 4311.500256903644, 4321.022799794616, 4330.548803758366, 4340.078246397915, 4349.611105431876, 4359.14735869417, 4368.686984133754, 4378.229959814343, 4387.776263914122, 4397.325874725463, 4406.878770654636, 4416.434930221515, 4425.994332059282, 4435.556954914135, 4445.122777644974, 4454.691779223117, 4464.263938731976, 4473.839235366753, 4483.417648434136, 4492.999157351974, 4502.583741648964, 4512.171380964339, 4521.762055047531, 4531.355743757865, 4540.952427064219, 4550.552085044699, 4560.154697886314, 4569.760245884637, 4579.368709443467, 4588.980069074503, 4598.594305396994, 4608.211399137404, 4617.831331129068, 4627.454082311839, 4637.079633731756, 4646.707966540686, 4656.339061995972, 4665.972901460086, 4675.609466400276, 4685.248738388202, 4694.890699099588, 4704.535330313865, 4714.182613913799, 4723.83253188514, 4733.485066316261, 4743.140199397781, 4752.797913422212, 4762.458190783588, 4772.121013977096, 4781.786365598707, 4791.454228344803, 4801.124585011816, 4810.79741849584, 4820.472711792268, 4830.150447995414, 4839.830610298137, 4849.513181991465, 4859.198146464216, 4868.885487202621, 4878.5751877899465, 4888.2672319061085, 4897.961603327298, 4907.658285925596, 4917.357263668591, 4927.058520618998, 4936.762040934274, 4946.467808866234, 4956.175808760664, 4965.886025056939, 4975.598442287636, 4985.313045078148, 4995.029818146299, 5004.748746301946, 5014.46981444661, 5024.193007573078], Label=HHExpLinearRate]]]\n" + 
				"			reverse rate plot: PlotNode [Title=RatePlot, X=mV, Y=ms-1, Data=[Data [X=[-8.00000011920929, -7.900000117719173, -7.800000116229057, -7.700000114738941, -7.600000113248825, -7.500000111758709, -7.400000110268593, -7.300000108778477, -7.200000107288361, -7.1000001057982445, -7.000000104308128, -6.900000102818012, -6.800000101327896, -6.70000009983778, -6.600000098347664, -6.500000096857548, -6.400000095367432, -6.3000000938773155, -6.200000092387199, -6.100000090897083, -6.000000089406967, -5.900000087916851, -5.800000086426735, -5.700000084936619, -5.600000083446503, -5.500000081956387, -5.4000000804662704, -5.300000078976154, -5.200000077486038, -5.100000075995922, -5.000000074505806, -4.90000007301569, -4.800000071525574, -4.700000070035458, -4.6000000685453415, -4.500000067055225, -4.400000065565109, -4.300000064074993, -4.200000062584877, -4.100000061094761, -4.000000059604645, -3.9000000581145287, -3.8000000566244125, -3.7000000551342964, -3.6000000536441803, -3.500000052154064, -3.400000050663948, -3.300000049173832, -3.200000047683716, -3.1000000461935997, -3.0000000447034836, -2.9000000432133675, -2.8000000417232513, -2.7000000402331352, -2.600000038743019, -2.500000037252903, -2.400000035762787, -2.3000000342726707, -2.2000000327825546, -2.1000000312924385, -2.0000000298023224, -1.9000000283122063, -1.8000000268220901, -1.700000025331974, -1.600000023841858, -1.5000000223517418, -1.4000000208616257, -1.3000000193715096, -1.2000000178813934, -1.1000000163912773, -1.0000000149011612, -0.9000000134110451, -0.800000011920929, -0.7000000104308128, -0.6000000089406967, -0.5000000074505806, -0.4000000059604645, -0.30000000447034836, -0.20000000298023224, -0.10000000149011612, 0.0, 0.10000000149011612, 0.20000000298023224, 0.30000000447034836, 0.4000000059604645, 0.5000000074505806, 0.6000000089406967, 0.7000000104308128, 0.800000011920929, 0.9000000134110451, 1.0000000149011612, 1.1000000163912773, 1.2000000178813934, 1.3000000193715096, 1.4000000208616257, 1.5000000223517418, 1.600000023841858, 1.700000025331974, 1.8000000268220901, 1.9000000283122063, 2.0000000298023224, 2.1000000312924385, 2.2000000327825546, 2.3000000342726707, 2.400000035762787, 2.500000037252903, 2.600000038743019, 2.7000000402331352, 2.8000000417232513, 2.9000000432133675, 3.0000000447034836, 3.1000000461935997, 3.200000047683716, 3.300000049173832, 3.400000050663948, 3.500000052154064, 3.6000000536441803, 3.7000000551342964, 3.8000000566244125, 3.9000000581145287, 4.000000059604645, 4.100000061094761, 4.200000062584877, 4.300000064074993, 4.400000065565109, 4.500000067055225, 4.6000000685453415, 4.700000070035458, 4.800000071525574, 4.90000007301569, 5.000000074505806, 5.100000075995922, 5.200000077486038, 5.300000078976154, 5.4000000804662704, 5.500000081956387, 5.600000083446503, 5.700000084936619, 5.800000086426735, 5.900000087916851, 6.000000089406967, 6.100000090897083, 6.200000092387199, 6.3000000938773155, 6.400000095367432, 6.500000096857548, 6.600000098347664, 6.70000009983778, 6.800000101327896, 6.900000102818012, 7.000000104308128, 7.1000001057982445, 7.200000107288361, 7.300000108778477, 7.400000110268593, 7.500000111758709, 7.600000113248825, 7.700000114738941, 7.800000116229057, 7.900000117719173, 8.00000011920929, 8.100000120699406, 8.200000122189522, 8.300000123679638, 8.400000125169754, 8.50000012665987, 8.600000128149986, 8.700000129640102, 8.800000131130219, 8.900000132620335, 9.00000013411045, 9.100000135600567, 9.200000137090683, 9.300000138580799, 9.400000140070915, 9.500000141561031, 9.600000143051147, 9.700000144541264, 9.80000014603138, 9.900000147521496], Y=[168.575374502285, 167.64144125094066, 166.71268213206096, 165.78906848016413, 164.87057178857918, 163.95716370856678, 163.0488160484435, 162.14550077271264, 161.24719000119802, 160.35385600818395, 159.46547122155962, 158.58200822196773, 157.7034397419585, 156.82973866514786, 155.9608780253808, 155.09683100589874, 154.2375709385122, 153.38307130277735, 152.53330572517783, 151.6882479783105, 150.84787198007592, 150.01215179287374, 149.18106162280154, 148.35457581885933, 147.53266887215727, 146.71531541512897, 145.90249022074798, 145.09416820174957, 144.29032440985617, 143.4909340350075, 142.69597240459493, 141.9054149826995, 141.11923736933545, 140.3374152996962, 139.55992464340628, 138.78674140377578, 138.01784171706046, 137.25320185172475, 136.49279820770926, 135.73660731570277, 134.98460583641736, 134.23677055986852, 133.49307840465843, 132.75350641726394, 132.01803177132763, 131.2866317669539, 130.5592838300077, 129.83596551141838, 129.1166544864865, 128.40132855419478, 127.6899656365231, 126.98254377776664, 126.27904114385888, 125.57943602169708, 124.88370681847262, 124.19183206100425, 123.50379039507521, 122.81956058477478, 122.139121511842, 121.46245217501459, 120.7895316893803, 120.12033928573237, 119.45485430992895, 118.79305622225492, 118.1349245967886, 117.4804391207708, 116.82957959397832, 116.18232592810007, 115.53865814611743, 114.89855638168734, 114.26200087852953, 113.62897198981626, 112.99945017756643, 112.3734160120423, 111.75085017114966, 111.13173343984191, 110.51604670952648, 109.90377097747552, 109.29488734623902, 108.68937702306187, 108.08722131930354, 107.48840164986154, 106.89289953259765, 106.30069658776745, 105.71177453745318, 105.12611520499941, 104.54370051445233, 103.9645124900015, 103.38853325542534, 102.8157450335391, 102.24613014564656, 101.67967101099393, 101.11635014622763, 100.55615016485456, 99.99905377670527, 99.44504378740062, 98.89410309782086, 98.3462147035781, 97.80136169449116, 97.25952725406403, 96.72069465896647, 96.18484727851826, 95.65196857417543, 95.12204209902018, 94.59505149725321, 94.0709805036887, 93.54981294325255, 93.03153273048302, 92.51612386903419, 92.00357045118244, 91.49385665733529, 90.98696675554324, 90.48288510101416, 89.98159613563054, 89.48308438746908, 88.98733447032339, 88.49433108322894, 88.00405900999095, 87.51650311871462, 87.03164836133814, 86.54947977316834, 86.0699824724186, 85.59314165974982, 85.1189426178133, 84.64737071079689, 84.17841138397291, 83.71205016324922, 83.24827265472229, 82.78706454423296, 82.32841159692481, 81.87229965680454, 81.41871464630539, 80.96764256585229, 80.51906949343008, 80.07298158415358, 79.62936506984053, 79.18820625858628, 78.7494915343416, 78.31320735649221, 77.87934025944082, 77.44787685219171, 77.01880381793717, 76.59210791364686, 76.16777596965849, 75.74579488927216, 75.3261516483453, 74.90883329489121, 74.49382694867921, 74.08111980083702, 73.6706991134555, 73.26255221919541, 72.85666652089648, 72.45302949118872, 72.05162867210561, 71.65245167469969, 71.25548617866022, 70.86071993193265, 70.46814075034085, 70.07773651721088, 69.68949518299705, 69.30340476490977, 68.91945334654615, 68.53762907752193, 68.15792017310577, 67.78031491385558, 67.40480164525664, 67.03136877736213, 66.66000478443526, 66.29069820459368, 65.9234376394554, 65.55821175378738, 65.19500927515541, 64.83381899357636, 64.4746297611721, 64.1174304918253, 63.76221016083759, 63.40895780458902, 63.057662520199855, 62.708313465193775, 62.36089985716362], Label=HHExpRate]]]\n" + 
				"		gate h:\n" + 
				"			instances: 1\n" + 
				"			forward rate: 70.0000 * exp((v - -0.0650000)/-0.0200000)\n" + 
				"			reverse rate: 1000.00 /(1 + exp((v - -0.0350000)/0.0100000))\n" + 
				"			forward rate plot: PlotNode [Title=RatePlot, X=mV, Y=ms-1, Data=[Data [X=[-8.00000011920929, -7.900000117719173, -7.800000116229057, -7.700000114738941, -7.600000113248825, -7.500000111758709, -7.400000110268593, -7.300000108778477, -7.200000107288361, -7.1000001057982445, -7.000000104308128, -6.900000102818012, -6.800000101327896, -6.70000009983778, -6.600000098347664, -6.500000096857548, -6.400000095367432, -6.3000000938773155, -6.200000092387199, -6.100000090897083, -6.000000089406967, -5.900000087916851, -5.800000086426735, -5.700000084936619, -5.600000083446503, -5.500000081956387, -5.4000000804662704, -5.300000078976154, -5.200000077486038, -5.100000075995922, -5.000000074505806, -4.90000007301569, -4.800000071525574, -4.700000070035458, -4.6000000685453415, -4.500000067055225, -4.400000065565109, -4.300000064074993, -4.200000062584877, -4.100000061094761, -4.000000059604645, -3.9000000581145287, -3.8000000566244125, -3.7000000551342964, -3.6000000536441803, -3.500000052154064, -3.400000050663948, -3.300000049173832, -3.200000047683716, -3.1000000461935997, -3.0000000447034836, -2.9000000432133675, -2.8000000417232513, -2.7000000402331352, -2.600000038743019, -2.500000037252903, -2.400000035762787, -2.3000000342726707, -2.2000000327825546, -2.1000000312924385, -2.0000000298023224, -1.9000000283122063, -1.8000000268220901, -1.700000025331974, -1.600000023841858, -1.5000000223517418, -1.4000000208616257, -1.3000000193715096, -1.2000000178813934, -1.1000000163912773, -1.0000000149011612, -0.9000000134110451, -0.800000011920929, -0.7000000104308128, -0.6000000089406967, -0.5000000074505806, -0.4000000059604645, -0.30000000447034836, -0.20000000298023224, -0.10000000149011612, 0.0, 0.10000000149011612, 0.20000000298023224, 0.30000000447034836, 0.4000000059604645, 0.5000000074505806, 0.6000000089406967, 0.7000000104308128, 0.800000011920929, 0.9000000134110451, 1.0000000149011612, 1.1000000163912773, 1.2000000178813934, 1.3000000193715096, 1.4000000208616257, 1.5000000223517418, 1.600000023841858, 1.700000025331974, 1.8000000268220901, 1.9000000283122063, 2.0000000298023224, 2.1000000312924385, 2.2000000327825546, 2.3000000342726707, 2.400000035762787, 2.500000037252903, 2.600000038743019, 2.7000000402331352, 2.8000000417232513, 2.9000000432133675, 3.0000000447034836, 3.1000000461935997, 3.200000047683716, 3.300000049173832, 3.400000050663948, 3.500000052154064, 3.6000000536441803, 3.7000000551342964, 3.8000000566244125, 3.9000000581145287, 4.000000059604645, 4.100000061094761, 4.200000062584877, 4.300000064074993, 4.400000065565109, 4.500000067055225, 4.6000000685453415, 4.700000070035458, 4.800000071525574, 4.90000007301569, 5.000000074505806, 5.100000075995922, 5.200000077486038, 5.300000078976154, 5.4000000804662704, 5.500000081956387, 5.600000083446503, 5.700000084936619, 5.800000086426735, 5.900000087916851, 6.000000089406967, 6.100000090897083, 6.200000092387199, 6.3000000938773155, 6.400000095367432, 6.500000096857548, 6.600000098347664, 6.70000009983778, 6.800000101327896, 6.900000102818012, 7.000000104308128, 7.1000001057982445, 7.200000107288361, 7.300000108778477, 7.400000110268593, 7.500000111758709, 7.600000113248825, 7.700000114738941, 7.800000116229057, 7.900000117719173, 8.00000011920929, 8.100000120699406, 8.200000122189522, 8.300000123679638, 8.400000125169754, 8.50000012665987, 8.600000128149986, 8.700000129640102, 8.800000131130219, 8.900000132620335, 9.00000013411045, 9.100000135600567, 9.200000137090683, 9.300000138580799, 9.400000140070915, 9.500000141561031, 9.600000143051147, 9.700000144541264, 9.80000014603138, 9.900000147521496], Y=[4.04910271012606, 4.028907725357897, 4.008813463500212, 3.988819422195374, 3.968925101591271, 3.9491300043288176, 3.9294336355295103, 3.9098355027830682, 3.8903351161351183, 3.8709319880749398, 3.8516256335232826, 3.832415569820243, 3.813301316713195, 3.794282396344775, 3.77535833324095, 3.756528654299124, 3.737792888776303, 3.719150568277341, 3.700601226743221, 3.6821444004394, 3.6637796279442276, 3.6455064501374013, 3.627324410188488, 3.6092330535455095, 3.5912319279235723, 3.5733205832935684, 3.555498571870911, 3.537765448104358, 3.5201207686648535, 3.5025640924344636, 3.485094980495333, 3.467712996118722, 3.4504177047540843, 3.4332086740182004, 3.416085473684375, 3.3990476756716776, 3.3820948540342353, 3.3652265849505945, 3.34844244671312, 3.3317420197174465, 3.315124886452, 3.298590631487555, 3.2821388414668413, 3.2657691050942224, 3.2494810131254073, 3.233274158357216, 3.217148135617406, 3.2011025417545382, 3.185136975627903, 3.169251038097482, 3.153444332013984, 3.1377164622089007, 3.122067035484641, 3.1064956606046903, 3.091001948283838, 3.075585511178441, 3.0602459638767368, 3.0449829228892202, 3.0297960066390397, 3.01468483545247, 2.9996490315494193, 2.9846882190339743, 2.9698020238850185, 2.9549900739468677, 2.9402519989199756, 2.9255874303516722, 2.9109960016269505, 2.8964773479593062, 2.8820311063816155, 2.867656915737057, 2.853354416670091, 2.83912325161747, 2.8249630647992974, 2.8108735022101405, 2.7968542116101744, 2.782904842516379, 2.7690250461937715, 2.7552144756466976, 2.7414727856101484, 2.72779963254113, 2.714194674610079, 2.7006575716923145, 2.6871879853595306, 2.673785578871344, 2.6604500171668706, 2.6471809668563457, 2.6339780962127977, 2.620841075163748, 2.6077695752829606, 2.5947632697822343, 2.5818218335032292, 2.5689449429093423, 2.5561322760776113, 2.543383512690675, 2.5306983340287634, 2.5180764229617223, 2.505517463941095, 2.49302114299223, 2.480587147706428, 2.468215167233136, 2.455904892272176, 2.4436560150660096, 2.4314682293920455, 2.419341230554983, 2.4072747153791982, 2.395268382201162, 2.3833219308618947, 2.3714350626994696, 2.359607480541543, 2.34783888869792, 2.3361289929531712, 2.3244775005592726, 2.3128841202282824, 2.3013485621250696, 2.289870537860059, 2.2784497604820233, 2.2670859444709133, 2.2557788057307153, 2.2445280615823515, 2.2333334307566104, 2.222194633387117, 2.2111113910033384, 2.200083426523614, 2.189110464248239, 2.1781922298525647, 2.16732845038014, 2.1565188542358946, 2.145763171179341, 2.135061132317822, 2.1244124700997884, 2.113816918308112, 2.1032742120534245, 2.0927840877675017, 2.0823462831966713, 2.0719605373952543, 2.061626590719046, 2.0513441848188223, 2.041113062633882, 2.0309329683856165, 2.0208036475711215, 2.0107248469568306, 2.000696314572184, 1.9907177997033325, 1.9807890528868626, 1.9709098259035733, 1.9610798717722524, 1.9512989447435183, 1.9415668002936677, 1.931883195118565, 1.922247887127557, 1.9126606354374247, 1.9031212003663598, 1.893629343427969, 1.8841848273253174, 1.8747874159449942, 1.8654368743512062, 1.85613296877991, 1.8468754666329648, 1.8376641364723167, 1.8284987480142145, 1.8193790721234542, 1.8103048808076443, 1.8012759472115132, 1.7922920456112343, 1.7833529514087836, 1.7744584411263218, 1.7656082924006133, 1.756802283977463, 1.7480401957061842, 1.7393218085340976, 1.7306469045010546, 1.7220152667339854, 1.7134266794414799, 1.7048809279083939, 1.6963777984904767, 1.687917078609034, 1.6794985567456142, 1.6711220224367147, 1.6627872662685261, 1.654494079871695], Label=HHExpRate]]]\n" + 
				"			reverse rate plot: PlotNode [Title=RatePlot, X=mV, Y=ms-1, Data=[Data [X=[-8.00000011920929, -7.900000117719173, -7.800000116229057, -7.700000114738941, -7.600000113248825, -7.500000111758709, -7.400000110268593, -7.300000108778477, -7.200000107288361, -7.1000001057982445, -7.000000104308128, -6.900000102818012, -6.800000101327896, -6.70000009983778, -6.600000098347664, -6.500000096857548, -6.400000095367432, -6.3000000938773155, -6.200000092387199, -6.100000090897083, -6.000000089406967, -5.900000087916851, -5.800000086426735, -5.700000084936619, -5.600000083446503, -5.500000081956387, -5.4000000804662704, -5.300000078976154, -5.200000077486038, -5.100000075995922, -5.000000074505806, -4.90000007301569, -4.800000071525574, -4.700000070035458, -4.6000000685453415, -4.500000067055225, -4.400000065565109, -4.300000064074993, -4.200000062584877, -4.100000061094761, -4.000000059604645, -3.9000000581145287, -3.8000000566244125, -3.7000000551342964, -3.6000000536441803, -3.500000052154064, -3.400000050663948, -3.300000049173832, -3.200000047683716, -3.1000000461935997, -3.0000000447034836, -2.9000000432133675, -2.8000000417232513, -2.7000000402331352, -2.600000038743019, -2.500000037252903, -2.400000035762787, -2.3000000342726707, -2.2000000327825546, -2.1000000312924385, -2.0000000298023224, -1.9000000283122063, -1.8000000268220901, -1.700000025331974, -1.600000023841858, -1.5000000223517418, -1.4000000208616257, -1.3000000193715096, -1.2000000178813934, -1.1000000163912773, -1.0000000149011612, -0.9000000134110451, -0.800000011920929, -0.7000000104308128, -0.6000000089406967, -0.5000000074505806, -0.4000000059604645, -0.30000000447034836, -0.20000000298023224, -0.10000000149011612, 0.0, 0.10000000149011612, 0.20000000298023224, 0.30000000447034836, 0.4000000059604645, 0.5000000074505806, 0.6000000089406967, 0.7000000104308128, 0.800000011920929, 0.9000000134110451, 1.0000000149011612, 1.1000000163912773, 1.2000000178813934, 1.3000000193715096, 1.4000000208616257, 1.5000000223517418, 1.600000023841858, 1.700000025331974, 1.8000000268220901, 1.9000000283122063, 2.0000000298023224, 2.1000000312924385, 2.2000000327825546, 2.3000000342726707, 2.400000035762787, 2.500000037252903, 2.600000038743019, 2.7000000402331352, 2.8000000417232513, 2.9000000432133675, 3.0000000447034836, 3.1000000461935997, 3.200000047683716, 3.300000049173832, 3.400000050663948, 3.500000052154064, 3.6000000536441803, 3.7000000551342964, 3.8000000566244125, 3.9000000581145287, 4.000000059604645, 4.100000061094761, 4.200000062584877, 4.300000064074993, 4.400000065565109, 4.500000067055225, 4.6000000685453415, 4.700000070035458, 4.800000071525574, 4.90000007301569, 5.000000074505806, 5.100000075995922, 5.200000077486038, 5.300000078976154, 5.4000000804662704, 5.500000081956387, 5.600000083446503, 5.700000084936619, 5.800000086426735, 5.900000087916851, 6.000000089406967, 6.100000090897083, 6.200000092387199, 6.3000000938773155, 6.400000095367432, 6.500000096857548, 6.600000098347664, 6.70000009983778, 6.800000101327896, 6.900000102818012, 7.000000104308128, 7.1000001057982445, 7.200000107288361, 7.300000108778477, 7.400000110268593, 7.500000111758709, 7.600000113248825, 7.700000114738941, 7.800000116229057, 7.900000117719173, 8.00000011920929, 8.100000120699406, 8.200000122189522, 8.300000123679638, 8.400000125169754, 8.50000012665987, 8.600000128149986, 8.700000129640102, 8.800000131130219, 8.900000132620335, 9.00000013411045, 9.100000135600567, 9.200000137090683, 9.300000138580799, 9.400000140070915, 9.500000141561031, 9.600000143051147, 9.700000144541264, 9.80000014603138, 9.900000147521496], Y=[62.973352320041904, 62.38584765379159, 61.803462548277146, 61.226159115624306, 60.653899622529266, 60.08664649217555, 59.52436230608702, 58.96700980591852, 58.414551895184886, 57.86695164092907, 57.3241722753308, 56.78617719725614, 56.252929973749275, 55.72439434146734, 55.200534208059075, 54.681313653488495, 54.16669693130401, 53.65664846985449, 53.1511328734528, 52.65011492348749, 52.15355957948426, 51.661431980117094, 51.173697444170784, 50.69032147145532, 50.211269743672815, 49.73650812523824, 49.26600266405453, 48.79971959224293, 48.33762532682953, 47.87968647038852, 47.425869811643366, 46.976142326026384, 46.53047117619762, 46.08882371252391, 45.65116747351869, 45.21747018624358, 44.78769976667223, 44.36182432001742, 43.93981214102202, 43.52163171421456, 43.10725171413014, 42.69664100549762, 42.28976864339319, 41.88660387336193, 41.487116131507086, 41.09127504454857, 40.69905042985085, 40.31041229542103, 39.925330839877894, 39.54377645239245, 39.16571971260061, 38.79113139048868, 38.41998244625235, 38.05224403012971, 37.687887482208815, 37.326884332210724, 36.969206299248164, 36.614825291560784, 36.263713406227446, 35.91584292885592, 35.571186333250914, 35.22971628106075, 34.891405621403166, 34.55622739047107, 34.224154811118446, 33.89516129242713, 33.569220429255026, 33.246306001765916, 32.92639197494185, 32.60945249807825, 32.295461904262226, 31.984394709834806, 31.676225613837367, 31.370929497442727, 31.068481423371356, 30.76885663529322, 30.47203055721568, 30.177978792857704, 29.88667712501115, 29.5981015148891, 29.312228101462026, 29.029033200782102, 28.74849330529576, 28.470585083145345, 28.195285377459907, 27.922571205635577, 27.652419758606015, 27.384808400103083, 27.11971466590827, 26.857116263095204, 26.596991069263368, 26.339317131763703, 26.084072666916057, 25.831236059219233, 25.580785860553412, 25.332700789375714, 25.086959729909083, 24.843541731324528, 24.602426006917426, 24.363591933277906, 24.127019049455566, 23.892687056119033, 23.660575814710352, 23.43066534659465, 23.202935832205362, 22.977367610184984, 22.753941176522005, 22.532637183683992, 22.313436439747036, 22.096319907522048, 21.881268703677804, 21.668264097861247, 21.457287511815018, 21.248320518492715, 21.041344841171703, 20.83634235256406, 20.63329507392563, 20.432185174163394, 20.23299496894146, 20.035706919785742, 19.84030363318754, 19.646767859706262, 19.45508249307132, 19.265230569283524, 19.07719526571607, 18.890959900215194, 18.706507930200807, 18.52382295176721, 18.342888698783913, 18.163689041996907, 17.986207988130374, 17.810429678989017, 17.636338390561246, 17.463918532123067, 17.29315464534326, 17.12403140338942, 16.956533610035507, 16.79064619877056, 16.62635423190913, 16.463642899703135, 16.302497519455535, 16.142903534635742, 15.984846513997098, 15.828312150696227, 15.673286261414539, 15.519754785482036, 15.367703784003332, 15.217119438986012, 15.067988052471668, 14.920296045669291, 14.774029958091345, 14.629176446692691, 14.485722285012145, 14.343654362316938, 14.202959682750178, 14.063625364481286, 13.925638638859471, 13.788986849570328, 13.65365745179574, 13.519638011376918, 13.386916203980775, 13.255479814269767, 13.125316735075021, 12.996414966573047, 12.868762615465855, 12.742347894164814, 12.617159119977975, 12.49318471430109, 12.370413201812418, 12.248833209671186, 12.12843346671983, 12.009202802690142, 11.89113014741321, 11.774204530033202, 11.65841507822521, 11.543751017416927, 11.430201670014318, 11.317756454631407, 11.20640488532393, 11.096136570827245], Label=HHSigmoidRate]]]";
				 

		Assert.assertEquals(expected, getInfoTreeAsString("NML2_SimpleIonChannel.nml"));
	}

	public void testNetwork() throws ContentError, ParseError, ParseException, BuildException, XMLException, IOException, ConnectionError, RuntimeError, JAXBException, GenerationException
	{
		String expected="Network InstanceBasedNetwork:\n" + 
				"	ID: InstanceBasedNetwork\n" + 
				"	Number of populations: 1\n" + 
				"	Population iafCells:\n" + 
				"		ID: iafCells\n" + 
				"		Size (number of instances): 3\n" + 
				"	Number of projections: 2\n" + 
				"	Projection internal1:\n" + 
				"		ID: internal1\n" + 
				"		Presynaptic population: iafCells\n" + 
				"		Postsynaptic population: iafCells\n" + 
				"	Projection internal2:\n" + 
				"		ID: internal2\n" + 
				"		Presynaptic population: iafCells\n" + 
				"		Postsynaptic population: iafCells";
		Assert.assertEquals(expected, getInfoTreeAsString("NML2_InstanceBasedNetwork.nml"));
	}
	
	/**
	 * Test method for {@link org.neuroml.export.info.InfoTreeCreator#createInfoTree(org.neuroml.model.NeuroMLDocument)}.
	 * @throws ContentError 
	 * @throws JAXBException 
	 */
	private String getInfoTreeAsString(String nmlFilename) throws ContentError, JAXBException
	{
		String content = JUtil.getRelativeResource(this.getClass(), Main.getNeuroMLExamplesResourcesDir()+"/"+nmlFilename);
		NeuroMLConverter nmlc = new NeuroMLConverter();
    	NeuroMLDocument nmlDocument = nmlc.loadNeuroML(content);
		InfoNode root = InfoTreeCreator.createInfoTree(nmlDocument);
		Assert.assertFalse(root.isEmpty());
		return root.toString();
	}

}
